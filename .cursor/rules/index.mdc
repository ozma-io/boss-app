---
alwaysApply: true
---

# BossUp

## Tech Stack
React Native + Expo + TypeScript + Firebase (Firestore, Auth, FCM, Cloud Functions)
- **Keyboard Handling**: `react-native-keyboard-controller` only (KeyboardAvoidingView not used)

## Key Architecture
- **Expo Development Build** - production-like environment with full native module support
- **CNG (Continuous Native Generation)** - `ios/` and `android/` folders are NOT committed (in `.gitignore`), regenerated by `npx expo prebuild`. NEVER manually edit native files. Use Expo config plugins in `app.config.ts` instead
- **Expo Router** - file-based navigation
- **TypeScript strict typing** - required for all code
- **Functional components** with hooks

## Build Production Releases
**Build production releases for both iOS and Android:**
```bash
npx eas-cli@latest workflow:run create-production-builds.yml
```


## Code Style
- **testID attributes** - all UI elements must have testID attributes for easier debugging in browser DevTools
  - Use kebab-case naming: `"profile-section"`, `"sign-out-button"`, `"avatar-image"`
  - Make names descriptive and self-explanatory
  - Include context when helpful: `"main-profile-section"`, `"auth-email-input"`
  - In browser DevTools, testID appears as `data-testid` attribute
- **Amplitude events** - all custom events MUST follow naming convention rules in `docs/amplitude-naming-convention.md` (snake_case, feature prefixes, specific names)
- **Logging**:
  - **App code**: use `services/logger.service.ts` (not console.log/error/warn)
  - **Cloud Functions**: use `functions/src/logger.ts` with Sentry integration (not console.log/error/warn)
  - Logger accepts two parameters: message and context object

## Project Structure
- `app/` - routing and screens
- `components/` - reusable UI components
- `services/` - Firebase services (auth, firestore, notifications)
- `types/` - TypeScript type definitions
- `utils/` - helper functions
- `functions/` - Firebase Cloud Functions
- `firestore/` - Firebase config, database migrations (run from root: `npx tsx firestore/migrations/run-migration.ts <name> --yes`)
- `docs/templates/` - store submission materials (app review instructions, release notes, screenshots, etc.)

## Firebase Data Model
- Users: `/users/{userId}`
- Bosses: `/users/{userId}/bosses/{bossId}`
- Entries: `/users/{userId}/bosses/{bossId}/entries/{entryId}`
- Entry types: `note`, `survey`, `interaction`, `fact`

### Data Organization Principle
**Timeline (Entries)** — frequently changing data (daily/weekly assessments):
- Current mood, stress level today, confidence this week
- Use `FactEntry` type for trackable metrics that change over time

**User/Boss Documents** — stable characteristics (rarely change):
- Position, department, goal, communication preferences, working hours
- Store as fields directly in User or Boss documents

## Security
- User data scoped to `userId` (Firebase rules enforce `request.auth.uid === userId`)
- Never expose other users' data

## Run Locally
- `npm run dev` — dev server (choose platform)
- `npm run web` — web browser
- `npm run ios` — iOS simulator (builds Development Build first time, ~5-10 min)
- `npm run android` — Android emulator (builds Development Build first time, ~5-10 min)

## Development Notes
- JavaScript changes reload instantly via hot reload
- Rebuild only needed when adding native modules or changing app.json
- **Rebuild iOS**: `cd ios && pod install && cd .. && npx expo run:ios`
- **Rebuild Android**: `npx expo run:android`
- Type all props, state, and function returns
- Handle authentication state properly
- **Version updates**: When bumping version, ALWAYS update in BOTH files:
  - `package.json` (version field)
  - `app.config.ts` (version field in config object)

## Find Details In
- **Tech stack & data model**: `README.md`
- **Setup instructions**: `SETUP.md`

### AI Chat Integration
AI-powered chat feature with OpenAI GPT-5:
- **Frontend:** `app/chat.tsx` - chat screen with typing indicator
- **Service:** `services/chat.service.ts` - message management, AI response triggering
- **Backend:** `functions/src/chat.ts` - Cloud Function with OpenAI API integration
- **Schema:** `firestore/schemas/chat.schema.ts` - OpenAI-compatible multimodal format
- **Types:** `types/index.ts` + `functions/src/types/chat.types.ts`
- **Config:** Message history window (24h), model selection in `functions/src/constants.ts`
